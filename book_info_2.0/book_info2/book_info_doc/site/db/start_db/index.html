
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../schema/">
      
      
        <link rel="next" href="../crud/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Стартовые скрипты - book info 2.0</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#postgresql" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="book info 2.0" class="md-header__button md-logo" aria-label="book info 2.0" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            book info 2.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Стартовые скрипты
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="book info 2.0" class="md-nav__button md-logo" aria-label="book info 2.0" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    book info 2.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    О проекте
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Установка
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    База данных
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            База данных
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Схема
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Стартовые скрипты
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Стартовые скрипты
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Уточнения по БД
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CRUD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get_auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Авторизация
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Книги
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Книги
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/books/get_books/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Получение книг по параметрам запроса
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/books/get_books_by_id/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Получение книги по id
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/books/post_books/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Добавление новой книги
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/books/put_books/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Изменение книги
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/books/delete_books/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Удаление книги
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Читатели
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Читатели
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/readers/get_readers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Получение читателей по параметрам запроса
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/readers/post_readers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Добавление нового читателя
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/readers/put_readers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Изменение читателя
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Работники
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Работники
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/workers/get_workers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Получение работников по параметрам запроса
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/workers/put_workers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Изменение работника
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Писатели
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Писатели
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/writers/get_writers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Получение писателей по параметрам запроса
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/writers/post_writers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Добавление нового писателя
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/writers/put_writers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Изменение писателя
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../payment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Оплата
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Уточнения по БД
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="postgresql">Скрипты для разворачивания Базы данных PostgreSQL</h1>
<h2 id="_1">Уточнения по БД</h2>
<ul>
<li>Скрипты накатываем согласно порядку, так как они имеют завимости</li>
<li>Скрипты содержат первичные тестовые данные для отладки. </li>
<li>БД нормализованна, поэтому для внесения новых данных нужно использовать временные таблицы: shelf.temp_table_writers, shelf.temp_table_publish, shelf.temp_table_book</li>
<li>При необходимости можно сделать временные таблицы для других постоянных таблиц. Перед работой с БД лучше изучить скрипты(комментарии есть)</li>
</ul>
<pre><code>-- таблица - словарь, содержит ключи - страны. Страны происхождения писателей и возможно еще для чего.
CREATE TABLE shelf.nation (
    nation_id SERIAL PRIMARY KEY,
    country VARCHAR(255) NOT null UNIQUE 
);

-- заполняем таблицу nation первыми странами. 
insert into shelf.nation (country)
values 
('Австралия'), ('Австрия'), ('Аргентина'), ('Бельгия'), ('Бразилия'),
('Великобритания'), ('Венгрия'), ('Вьетнам'), ('Германия'), ('Греция'),
('Дания'), ('Египет'), ('Израиль'), ('Индия'), ('Индонезия'),
('Ирландия'), ('Исландия'), ('Испания'), ('Италия'), ('Казахстан'),
('Канада'), ('Катар'), ('Кения'), ('Кипр'), ('Китай'),
('Колумбия'), ('Латвия'), ('Литва'), ('Люксембург'), ('Мексика'),
('Молдавия'), ('Нидерланды'), ('Новая Зеландия'), ('Норвегия'), ('ОАЭ'),
('Перу'), ('Польша'), ('Португалия'), ('Россия'), ('Румыния'),
('Саудовская Аравия'), ('Сербия'), ('Сингапур'), ('Словакия'), ('Словения'),
('США'), ('Таиланд'), ('Турция'), ('Украина'), ('Франция'),
('Чехия'), ('Швейцария'), ('Швеция'), ('ЮАР'), ('Япония');

-- таблица - словарь, содержит ключи - языки. Языки, на которых написаны книги и возможно еще для чего.
create table shelf.lang (
    lang_id SERIAL PRIMARY key,
    language varchar(255)
    );

-- заполняем таблицу lang первыми странами. 
insert into shelf.lang (language)
values 
('Русский'), ('Английский'), ('Немецкий'), ('Французский'), ('Испанский'),  
('Итальянский'), ('Португальский'), ('Китайский'), ('Японский'), ('Корейский'),  
('Арабский'), ('Хинди'), ('Бенгальский'), ('Турецкий'), ('Вьетнамский'),  
('Индонезийский'), ('Тайский'), ('Персидский'), ('Греческий'), ('Польский'),  
('Чешский'), ('Словацкий'), ('Венгерский'), ('Румынский'), ('Украинский'),  
('Белорусский'), ('Казахский'), ('Узбекский'), ('Таджикский'), ('Грузинский'),  
('Армянский'), ('Азербайджанский'), ('Литовский'), ('Латышский'), ('Эстонский'),  
('Финский'), ('Шведский'), ('Норвежский'), ('Датский'), ('Исландский'),  
('Сербский'), ('Хорватский'), ('Словенский'), ('Македонский'), ('Болгарский'),  
('Албанский'), ('Башкирский'), ('Татарский'), ('Чувашский'), ('Монгольский');

-- таблица справочник по жанрам
create table shelf.genre (
    genre_id SERIAL primary key,
    genre_name varchar(255)
    );

-- заполняем таблицу тестовыми жанрами
INSERT INTO shelf.genre (genre_name)  
VALUES  
('Детектив'),  
('Фантастика'),  
('Сказка'),  
('Роман'),  
('Приключения'),  
('Триллер'),  
('Фэнтези'),  
('Исторический роман'),  
('Биография'),  
('Психология'),  
('Научная литература'),  
('Саморазвитие'),  
('Хоррор'),  
('Поэзия'),  
('Драма'),  
('Комедия'),  
('Мистика'),  
('Научная фантастика'),  
('Классика'),  
('Современная литература');  


-- таблица справочник по издательствам
create table shelf.publish (
    publish_id serial primary key,
    publish_name varchar(255),
    country integer,
    foreign key (country) references shelf.nation(nation_id) on delete set null
    );

-- заполняем таблицу тестовыми издательствами
insert into shelf.publish (publish_name, country)
values
('Дрофа', 94), ('Колесо и Крест', 103);

-- Таблица писателей
CREATE TABLE shelf.writers (
    writer_id SERIAL PRIMARY KEY,
    last_name VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    second_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    nationality INTEGER,  -- Должно быть INTEGER!
    info TEXT,
    FOREIGN KEY (nationality) REFERENCES shelf.nation(nation_id) ON DELETE SET NULL
);

-- Временная таблица для писателей(используется для загрузки)
CREATE TABLE shelf.temp_table_writers (
    last_name VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    second_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    nationality VARCHAR(255), -- Название страны (не ID)
    info TEXT
);

-- перегоняем из временной таблицы в основную
INSERT INTO shelf.writers (last_name, name, second_name, birth_date, nationality, info)
SELECT
    tt.last_name,
    tt.name,
    tt.second_name,
    tt.birth_date,
    n.nation_id,  -- Теперь записываем числовой ID страны
    tt.info
FROM shelf.temp_table_writers tt
INNER JOIN shelf.nation n ON tt.nationality = n.country; -- Джойним по названию страны

-- перед заливкой из временной таблицы в постояную, нужно обновить словарь со странами
INSERT INTO shelf.nation (country)
SELECT DISTINCT nationality
FROM shelf.temp_table_writers
ON CONFLICT (country) 
DO UPDATE SET country = excluded.country;


-- создаем таблицу для книг
create table shelf.book (
    book_id serial primary key,
    book_name varchar(255) not null,
    date_publish integer not null,
    language integer,
    publish integer,
    writer integer,
    genre integer,
    foreign key (language) references shelf.lang (lang_id) on delete set null, 
    foreign key (publish) references shelf.publish (publish_id) on delete set null,
    foreign key (writer) references shelf.writers (writer_id) on delete set null,
    foreign key (genre) references shelf.genre (genre_id) on delete set null);

-- первые тестовые данные для таблицы book
insert into shelf.book (book_name, date_publish , language, publish, writer, genre)
values 
    ('Колобок', '1876', 1, 1, 174, 1);

-- словарь для статуса работника библиотеки
create table shelf.status_worker (
    status_id serial primary key,
    status varchar(255) not null
    );

-- заполняем словарь статусов работников
insert into shelf.status_worker (status)
values 
    ('Работает'), ('Уволен'), ('Отпуск'), ('Больничный');

-- таблица читатели
create table shelf.readers (
    reader_id serial primary key,
    surname varchar(255),
    name varchar(255),
    second_name varchar(255),
    aboniment integer not null,
    active_aboniment bool,
    birth_date DATE NOT NULL,             -- Дата рождения
    phone_number VARCHAR(20) UNIQUE,      -- Телефон (уникальный)
    email VARCHAR(255) UNIQUE,            -- Email (уникальный, для уведомлений)
    address TEXT,                          -- Адрес проживания
    registration_date TIMESTAMP DEFAULT NOW()
    );

-- заполнение таблицы читателей
INSERT INTO shelf.readers (surname, name, second_name, aboniment, active_aboniment, birth_date, phone_number, email, address)  
VALUES  
    ('Иванов', 'Алексей', 'Сергеевич', '4568254', true, '1990-05-12', '+79876543210', 'ivanov.alex@mail.ru', 'Москва, ул. Ленина, д. 10'),  
    ('Петров', 'Игорь', 'Андреевич', '45621458', false, '1985-09-22', '+79161234567', 'petrov.igor@gmail.com', 'Санкт-Петербург, Невский пр., д. 50'),  
    ('Сидорова', 'Мария', 'Викторовна', '74185296', true, '1995-07-15', '+79234567890', 'maria.sid@gmail.com', 'Казань, ул. Баумана, д. 3');  


-- таблица словарь должностей работников
create table shelf.roles (
    role_id serial primary key,
    role varchar(255)
    );

-- заполняем таблицу с должностяи работников
insert into shelf.roles (role)
values 
    ('Старший библиотекарь'), 
    ('Младший библиотекарь'), 
    ('Директор'), 
    ('Стажер');

-- таблица сотрудников
create table shelf.workers(
    worker_id serial primary key,
    surname varchar(255),
    name varchar(255),
    second_name varchar(255),
    role integer,                    -- ссылаемся на таблицу roles, чтобы определить должность
    status integer,                       -- ссыаемся на таблицу status_worker чтобы опредилить статус работника
    birth_date DATE NOT NULL,             -- Дата рождения
    phone_number VARCHAR(20) UNIQUE,      -- Телефон (уникальный)
    email VARCHAR(255) UNIQUE,            -- Email (уникальный, для уведомлений)
    address TEXT,
    foreign key (role) references shelf.roles(role_id),
    foreign key (status) references shelf.status_worker(status_id)
    );

-- заполняем таблицу работников
insert into shelf.workers (surname, name, second_name, birth_date, phone_number, email, address)
values 
    ('Иванов', 'Иван', 'Иванович', '1990-12-01', '77705874212', 'gfddgg@mai.com', 'Алматы, дом 10');

-- таблица историчности взятие/сдачи книги
create table shelf.history (
    history_id serial primary key,
    reader_id integer,
    book_id integer,
    worker_id integer,
    borrow_date timestamp default now(),
    return_date timestamp,
    foreign key (reader_id) references shelf.readers(reader_id),
    foreign key (worker_id) references shelf.workers(worker_id),
    foreign key (book_id) references shelf.book(book_id)
    );

-- таблицу заполняем историчности
insert into shelf.history (reader_id, book_id, worker_id, borrow_date, return_date)
values 
    (1, 3, 1, '2025-02-12', '2025-03-01');

------------------------------------------------------------------------------------------------------------------
-- Временная таблица для издательства(используется для загрузки)
CREATE TABLE shelf.temp_table_publish (
    name VARCHAR(255) NOT NULL,
    nationality VARCHAR(255) -- Название страны (не ID)
);

-- перегоняем из временной таблицы в основную
INSERT INTO shelf.publish (publish_name, country)
SELECT
    tt.name,
    n.nation_id  -- Теперь записываем числовой ID страны
FROM shelf.temp_table_publish tt
INNER JOIN shelf.nation n ON tt.nationality = n.country; -- Джойним по названию страны

-- перед заливкой из временной таблицы в постояную, нужно обновить словарь со странами
INSERT INTO shelf.nation (country)
SELECT DISTINCT nationality
FROM shelf.temp_table_publish
ON CONFLICT (country) 
DO UPDATE SET country = excluded.country;
-----------------------------------------------------------------------------------------------------------------------
-- Временная таблица для книг(используется для загрузки) (есть проблема потенциальная с писателями и с издательсвами. 
-- Сложно обновлять старые таблицы, нужно над запросом, пока не углубляюсь, поэтому не трогаю.)
CREATE TABLE shelf.temp_table_book (
    book_name varchar(255) not null,
    date_publish varchar(255),
    language varchar(255),
    publish varchar(255),
    writer varchar(255),
    genre varchar(255)
);

-- перегоняем из временной таблицы в основную
INSERT INTO shelf.book (book_name, date_publish, language, publish, writer, genre)
SELECT
    tt.book_name,
    tt.date_publish,
    l.lang_id,
    p.publish_id,
    tt.writer,  
    g.genre_id
FROM shelf.temp_table_book tt
INNER JOIN shelf.lang l ON tt.language = l.language -- Джойним по языку
INNER JOIN shelf.publish p ON tt.publish = p.publish_name -- Джойним по названию издательства
INNER JOIN shelf.genre g ON tt.genre = g.genre_name; -- Джойним по названию страны

-- перед заливкой из временной таблицы в постояную, нужно обновить словарь с языками
INSERT INTO shelf.lang (language)
SELECT DISTINCT language
FROM shelf.temp_table_book
ON CONFLICT (language) 
DO UPDATE SET language = excluded.language;

-- перед заливкой из временной таблицы в постояную, нужно обновить словарь со жанрами
INSERT INTO shelf.genre (genre_name)
SELECT DISTINCT genre
FROM shelf.temp_table_book
ON CONFLICT (genre_name) 
DO UPDATE SET genre_name = excluded.genre_name;
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>